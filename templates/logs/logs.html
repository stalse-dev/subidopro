{% extends 'main.html' %}
{% load tz %}
{% load humanize %}

{% block containerBodyMain %}
<!-- =============================================================== -->
<!-- INÍCIO DO CONTEÚDO DA PÁGINA DE LOGS                            -->
<!-- =============================================================== -->
<div class="max-w-7xl mx-auto">
    
    <!-- Cabeçalho Principal -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Logs do Cloud Run</h1>
        <p class="text-gray-500 mt-1">Exibindo as últimas 50 requisições HTTP registradas no serviço.</p>
    </div>

    <!-- Lista de Logs -->
    <div class="space-y-4">
        {% for log in logs %}
        <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
            <!-- Linha Principal do Log -->
            <div class="p-4 flex flex-col sm:flex-row items-start sm:items-center gap-4">
                <!-- Método e Status -->
                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <!-- Badge do Método -->
                    {% with method_color='bg-gray-200 text-gray-800' %}
                        {% if log.method == 'GET' %}{% with method_color='bg-blue-100 text-blue-800' %}{% endwith %}{% endif %}
                        {% if log.method == 'POST' %}{% with method_color='bg-green-100 text-green-800' %}{% endwith %}{% endif %}
                        {% if log.method == 'PATCH' or log.method == 'PUT' %}{% with method_color='bg-yellow-100 text-yellow-800' %}{% endwith %}{% endif %}
                        {% if log.method == 'DELETE' %}{% with method_color='bg-red-100 text-red-800' %}{% endwith %}{% endif %}
                        <span class="font-mono text-xs font-bold px-2.5 py-1 rounded-md {{ method_color }}">{{ log.method|default:'---' }}</span>
                    {% endwith %}

                    <!-- Badge do Status -->
                    {% with status_color='bg-gray-200 text-gray-800' %}
                        {% if log.status >= 200 and log.status < 300 %}{% with status_color='bg-green-100 text-green-800' %}{% endwith %}{% endif %}
                        {% if log.status >= 300 and log.status < 400 %}{% with status_color='bg-yellow-100 text-yellow-800' %}{% endwith %}{% endif %}
                        {% if log.status >= 400 and log.status < 500 %}{% with status_color='bg-orange-100 text-orange-800' %}{% endwith %}{% endif %}
                        {% if log.status >= 500 %}{% with status_color='bg-red-100 text-red-800' %}{% endwith %}{% endif %}
                        <span class="font-mono text-xs font-bold px-2.5 py-1 rounded-md {{ status_color }}">{{ log.status|default:'---' }}</span>
                    {% endwith %}
                </div>
                
                <!-- URL -->
                <div class="flex-grow font-mono text-sm text-gray-600 break-all">
                    {{ log.url }}
                </div>
            </div>
            
            <!-- Detalhes do Log -->
            <div class="bg-gray-50/70 border-t p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-x-6 gap-y-4 text-xs">
                <div class="flex flex-col">
                    <span class="text-gray-500 uppercase font-semibold">Timestamp</span>
                    <span class="font-mono text-gray-800">{{ log.timestamp|timezone:"America/Sao_Paulo"|date:"d/m/Y H:i:s" }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-gray-500 uppercase font-semibold">Severidade</span>
                    <span class="font-mono font-bold {% if log.severity == 'WARNING' %}text-yellow-600{% elif log.severity == 'ERROR' or log.severity == 'CRITICAL' %}text-red-600{% else %}text-gray-800{% endif %}">{{ log.severity }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-gray-500 uppercase font-semibold">IP Remoto</span>
                    <span class="font-mono text-gray-800">{{ log.remote_ip|default:'-' }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-gray-500 uppercase font-semibold">IP Servidor</span>
                    <span class="font-mono text-gray-800">{{ log.server_ip|default:'-' }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-gray-500 uppercase font-semibold">Latência</span>
                    <span class="font-mono text-gray-800">{{ log.latency|default:'-' }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-gray-500 uppercase font-semibold">Tamanho</span>
                    <span class="font-mono text-gray-800">{{ log.response_size|default:'-' }}</span>
                </div>
                <div class="flex flex-col col-span-2 md:col-span-3 lg:col-span-4 xl:col-span-1">
                    <span class="text-gray-500 uppercase font-semibold">User Agent</span>
                    <span class="font-mono text-gray-800 truncate" title="{{ log.user_agent }}">{{ log.user_agent|truncatechars:50 }}</span>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-16 px-6 bg-white rounded-lg shadow-md">
            <span class="material-symbols-outlined text-6xl text-gray-300">history</span>
            <p class="font-semibold text-xl mt-4 text-gray-700">Nenhum log encontrado.</p>
            <p class="text-gray-500 text-sm mt-1">Não foi possível carregar os logs do Cloud Run no momento.</p>
        </div>
        {% endfor %}
    </div>
</div>
<!-- =============================================================== -->
<!-- FIM DO CONTEÚDO DA PÁGINA DE LOGS                               -->
<!-- =============================================================== -->
{% endblock %}
