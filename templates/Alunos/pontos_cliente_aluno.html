{% extends 'Alunos/aluno_campeonato.html' %}
{% load humanize %}

{% block containerAluno %}
<!-- =============================================================== -->
<!-- INÍCIO DO CONTEÚDO DA PÁGINA DE CLIENTES E CONTRATOS             -->
<!-- =============================================================== -->
<div class="bg-white rounded-xl shadow-lg overflow-hidden">
    <!-- Cabeçalho da Seção -->
    <div class="p-5 bg-gray-50 border-b">
        <h2 class="text-2xl font-bold text-gray-800">Meus Clientes e Contratos</h2>
        <p class="text-sm text-gray-500">Lista de todos os clientes, seus contratos e envios aprovados.</p>
    </div>

    <!-- Lista de Clientes (Acordeão Nível 1) -->
    <div class="divide-y divide-gray-200">
        {% for cliente in clientes %}
        <details class="group">
            <!-- Resumo do Cliente (Layout Enriquecido) -->
            <summary class="list-none flex flex-col md:flex-row items-center justify-between p-5 cursor-pointer hover:bg-gray-100 transition-colors gap-4">
                <!-- Lado Esquerdo: Título e Documento -->
                <div class="flex items-center gap-4 flex-grow w-full md:w-auto">
                    <span class="material-symbols-outlined text-3xl text-gray-500">business_center</span>
                    <div>
                        <p class="font-bold text-gray-900">{{ cliente.cliente_titulo }}</p>
                        <p class="text-sm text-gray-500 font-mono">{{ cliente.cliente_documento }}</p>
                    </div>
                </div>
                <!-- Lado Direito: Contagem, Data e Botão -->
                <div class="flex items-center gap-6 w-full md:w-auto">
                    <div class="hidden lg:block text-center">
                        <p class="font-bold text-lg text-gray-800">{{ cliente.contratos|length }}</p>
                        <p class="text-xs text-gray-500">CONTRATO(S)</p>
                    </div>
                    <div class="hidden lg:block text-center">
                        <p class="font-bold text-lg text-gray-800">{{ cliente.contratos.envios|length }}</p>
                        <p class="text-xs text-gray-500">ENVIOS(S)</p>
                    </div>
                    <div class="hidden sm:block text-right">
                        <p class="text-sm text-gray-500">Criado em</p>
                        <p class="font-semibold text-gray-800">{{ cliente.cliente_data_criacao|date:"d/m/Y" }}</p>
                    </div>
                    <div class="text-gray-400 group-open:rotate-180 transition-transform duration-300 ml-auto">
                        <span class="material-symbols-outlined text-3xl">expand_more</span>
                    </div>
                </div>
            </summary>

            <!-- Detalhes do Cliente: Contratos (Acordeão Nível 2) -->
            <div class="pl-5 pr-5 pb-5 border-t bg-gray-50/70">
                <div class="mt-4 space-y-3">
                {% for contrato in cliente.contratos %}
                    <details class="group/contrato bg-white rounded-lg shadow-sm border">
                        <!-- Resumo do Contrato -->
                        <summary class="list-none flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <span class="material-symbols-outlined text-xl text-gray-500">description</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Contrato de {{ contrato.contrato_data|date:"d/m/Y" }}</p>
                                    <p class="text-xs text-blue-600 font-semibold">{{ contrato.pontos|floatformat:0 }} pontos</p>
                                </div>
                            </div>
                            <div class="text-gray-400 group-open/contrato:rotate-180 transition-transform duration-300">
                                <span class="material-symbols-outlined">expand_more</span>
                            </div>
                        </summary>
                        <!-- Detalhes do Contrato: Envios (Nível 3) -->
                        <div class="p-4 border-t bg-gray-50/50 rounded-b-lg">
                            <h5 class="text-sm font-semibold mb-2 text-gray-600">Envios Aprovados:</h5>
                            <ul class="space-y-2">
                                {% for envio in contrato.envios %}
                                <li class="flex items-center text-sm text-green-700">
                                    <span class="material-symbols-outlined !text-base mr-2">check_circle</span>
                                    <span>Envio de {{ envio.data|date:"d/m/Y" }}</span>
                                </li>
                                {% empty %}
                                <li class="text-sm text-gray-500">Nenhum envio aprovado para este contrato.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </details>
                {% endfor %}
                </div>
            </div>
        </details>
        {% empty %}
        <div class="text-center py-16 px-6">
            <span class="material-symbols-outlined text-6xl text-gray-300">person_off</span>
            <p class="font-semibold text-xl mt-4 text-gray-700">Nenhum cliente encontrado.</p>
            <p class="text-gray-500 text-sm mt-1">Este aluno ainda não possui clientes com contratos pontuados.</p>
        </div>
        {% endfor %}
    </div>
</div>
<!-- =============================================================== -->
<!-- FIM DO CONTEÚDO DA PÁGINA DE CLIENTES E CONTRATOS               -->
<!-- =============================================================== -->
{% endblock %}
